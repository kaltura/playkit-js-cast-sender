!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("kaltura-player-js")):"function"==typeof define&&define.amd?define("sender",["kaltura-player-js"],t):"object"==typeof exports?exports.sender=t(require("kaltura-player-js")):(e.KalturaPlayer=e.KalturaPlayer||{},e.KalturaPlayer.cast=e.KalturaPlayer.cast||{},e.KalturaPlayer.cast.sender=t(e.KalturaPlayer))}("undefined"!=typeof self?self:this,function(e){return function(e){function t(n){if(a[n])return a[n].exports;var r=a[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,n){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(t,a){t.exports=e},function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.CastPlayer=t.CUSTOM_CHANNEL=t.SECONDS_TO_MINUTES_DIVIDER=t.INTERVAL_FREQUENCY=void 0;var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=a(0),c=a(3),l=a(4),u=a(5),h=a(6),d=a(7),_=a(8),y=a(9),f=o.core.Env,v=(o.core.Track,o.core.TextStyle,o.core.EventType),p=o.core.StateType,g=o.core.FakeEvent,m=o.core.Utils,E=o.core.EngineType,k=o.core.AbrMode,C=o.core.Error,T=o.cast.BaseRemotePlayer,S=o.cast.PlayerSnapshot,b=(o.cast.RemoteControl,o.cast.RemoteConnectedPayload),P=o.cast.RemoteDisconnectedPayload,A=o.cast.RemoteAvailablePayload,I=o.cast.RemoteSession,w=o.cast.TextStyleConverter,R=o.cast.CustomMessageType,O=(o.cast.CustomMessage,o.cast.CustomEventMessage,t.INTERVAL_FREQUENCY=500),M=t.SECONDS_TO_MINUTES_DIVIDER=60,D=t.CUSTOM_CHANNEL="urn:x-cast:com.kaltura.cast.playkit",L=function(e){function t(e,a){n(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"CastPlayer",e,a));return i._readyPromise=null,i._mediaInfo=null,i._firstPlay=!0,i._ended=!1,i._playbackStarted=!1,i._reset=!0,i._destroyed=!1,d.CastLoader.load().then(function(){i._initializeCastApi(),i._initializeRemotePlayer()}).catch(function(e){i._logger.error("Cast initialized error",e)}),i}return i(t,e),s(t,null,[{key:"isSupported",value:function(){return"Chrome"===f.browser.name}}]),s(t,[{key:"loadMedia",value:function(e,t){var a=this;this._logger.debug("Load media",e,t),this.reset(),this._remoteControl.getUIWrapper().reset(),this._mediaInfo=e,this._playbackStarted&&this.dispatchEvent(new g(v.CHANGE_SOURCE_STARTED));var n=new chrome.cast.media.MediaInfo,r=new chrome.cast.media.LoadRequest(n);return t&&Object.keys(t).forEach(function(e){"media"!==e?r[e]=t[e]:Object.keys(t.media).forEach(function(e){n[e]=t.media[e]})}),n.customData=n.customData||{},n.customData.mediaInfo=e,this._castSession.loadMedia(r).then(function(){return a._onLoadMediaSuccess()},function(e){return a._onLoadMediaFailed(e)})}},{key:"getMediaInfo",value:function(){return m.Object.copyDeep(this._mediaInfo)}},{key:"ready",value:function(){return this._readyPromise?this._readyPromise:Promise.resolve()}},{key:"play",value:function(){!this.ended||this._adsManager.adBreak?this._engine.play():this._mediaInfo&&this.loadMedia(this._mediaInfo)}},{key:"pause",value:function(){this._engine.pause()}},{key:"reset",value:function(){clearInterval(this._mediaInfoIntervalId),this._reset||(this._reset=!0,this._firstPlay=!0,this._ended=!1,this._tracksManager.reset(),this._engine.reset(),this._adsManager.reset(),this._stateManager.reset(),this._readyPromise=this._createReadyPromise(),this.dispatchEvent(new g(v.PLAYER_RESET)))}},{key:"destroy",value:function(){clearInterval(this._mediaInfoIntervalId),this._destroyed||(this._destroyed=!0,this._firstPlay=!0,this._ended=!1,this._readyPromise=null,this._eventManager.destroy(),this._tracksManager.destroy(),this._engine.destroy(),this._adsManager.destroy(),this._stateManager.destroy(),this.dispatchEvent(new g(v.PLAYER_DESTROY)))}},{key:"isLive",value:function(){var e=this._castRemotePlayer.mediaInfo;return!!e&&e.streamType===chrome.cast.media.StreamType.LIVE}},{key:"isDvr",value:function(){if(this.isLive()){var e=this._castSession.getMediaSession();if(e){var t=e.liveSeekableRange;if(t){var a=t.start/M;return t.end/M-a>this._castConfig.liveEdgeThreshold}}}return!1}},{key:"seekToLiveEdge",value:function(){var e=this._castSession.getMediaSession();if(e){var t=e.liveSeekableRange;t&&(this._engine.currentTime=t.end)}}},{key:"getStartTimeOfDvrWindow",value:function(){var e=this._castSession.getMediaSession();if(e){var t=e.liveSeekableRange;if(t)return t.start}return 0}},{key:"getTracks",value:function(e){return this._tracksManager.getTracks(e)}},{key:"getActiveTracks",value:function(){return this._tracksManager.getActiveTracks()}},{key:"selectTrack",value:function(e){this._tracksManager.selectTrack(e)}},{key:"hideTextTrack",value:function(){this._tracksManager.hideTextTrack()}},{key:"startCasting",value:function(){return cast&&cast.framework?cast.framework.CastContext.getInstance().requestSession():Promise.reject()}},{key:"isCastAvailable",value:function(){return!!this._castRemotePlayer}},{key:"stopCasting",value:function(){this._castSession.endSession(!0)}},{key:"getCastSession",value:function(){return m.Object.copyDeep(this._remoteSession)}},{key:"_initializeCastApi",value:function(){var e=this,t={};t.receiverApplicationId=this._castConfig.receiverApplicationId||chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,t.autoJoinPolicy=this._castConfig.autoJoinPolicy||chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,this._logger.debug("Init cast API with options",t);var a=cast.framework.CastContext.getInstance();a.setOptions(t),a.addEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,function(t){var a=new A(e,t.castState!==cast.framework.CastState.NO_DEVICES_AVAILABLE);e._remoteControl.onRemoteDeviceAvailable(a)})}},{key:"_initializeRemotePlayer",value:function(){var e=this;this._castContext=cast.framework.CastContext.getInstance(),this._addSessionLifecycleListeners(),this._castRemotePlayer=new cast.framework.RemotePlayer,this._castRemotePlayerController=new cast.framework.RemotePlayerController(this._castRemotePlayer),this._castRemotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED,function(){e._castRemotePlayer.isConnected?e._setupRemotePlayer():e._setupLocalPlayer()})}},{key:"_setupRemotePlayer",value:function(){var e=this;this._logger.debug("Setup remote player"),this._castSession=cast.framework.CastContext.getInstance().getCurrentSession(),this._castSession.addMessageListener(D,function(t,a){return e._onCustomMessage(t,a)}),this._tracksManager=new l.CastTracksManager(this._castRemotePlayer),this._engine=new u.CastPlaybackEngine(this._castRemotePlayer,this._castRemotePlayerController),this._stateManager=new c.CastStateManager(this._castRemotePlayer,this._castRemotePlayerController),this._adsManager=new y.CastAdsManager(this),this._ui=new h.CastUI,this._attachListeners();var t=this._remoteControl.getPlayerSnapshot();this._playerConfig=t.config,this._remoteSession=new I(this._castSession.getSessionId(),this._castSession.getCastDevice().friendlyName,this._castSession.getSessionState()!==cast.framework.SessionState.SESSION_STARTED);var a=new b(this,this._remoteSession,this._ui);if(this._remoteControl.onRemoteDeviceConnected(a),this._remoteSession.resuming)this._resumeSession();else if(t&&t.mediaInfo){var n=t.mediaInfo,r=this._getLoadOptions(t);this.loadMedia(n,r)}}},{key:"_setupLocalPlayer",value:function(){this._logger.debug("Setup local player");var e=new S(this),t=new P(this,e);this.pause(),this.destroy(),this._remoteControl.onRemoteDeviceDisconnected(t)}},{key:"_createReadyPromise",value:function(){var e=this;this._readyPromise=new Promise(function(t){e._eventManager.listenOnce(e,v.TRACKS_CHANGED,function(){e.dispatchEvent(new g(v.MEDIA_LOADED)),t()})})}},{key:"_attachListeners",value:function(){var e=this;this._eventManager.listen(this._engine,v.TIME_UPDATE,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._engine,v.PAUSE,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._engine,v.PLAY,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._engine,v.VOLUME_CHANGE,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._engine,v.MUTE_CHANGE,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._engine,v.DURATION_CHANGE,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._engine,v.ENDED,function(t){return e._onEnded(t)}),this._eventManager.listen(this._engine,v.SEEKING,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._engine,v.SEEKED,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._tracksManager,v.TRACKS_CHANGED,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._tracksManager,v.TEXT_TRACK_CHANGED,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._tracksManager,v.VIDEO_TRACK_CHANGED,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._tracksManager,v.AUDIO_TRACK_CHANGED,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._tracksManager,v.TEXT_STYLE_CHANGED,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._tracksManager,v.ERROR,function(t){return e.dispatchEvent(t)}),this._eventManager.listen(this._stateManager,v.PLAYER_STATE_CHANGED,function(t){return e._onPlayerStateChanged(t)})}},{key:"_onEnded",value:function(e){var t=this;this._ended=!0,this.dispatchEvent(e),this._adsManager.allAdsCompleted?this.dispatchEvent(new g(v.PLAYBACK_ENDED)):this._eventManager.listenOnce(this,v.ALL_ADS_COMPLETED,function(){t.dispatchEvent(new g(v.PLAYBACK_ENDED))})}},{key:"_onPlayerStateChanged",value:function(e){this._ended||(this._stateManager.currentState.type===p.PLAYING&&this.dispatchEvent(new g(v.PLAYING)),this.dispatchEvent(e))}},{key:"_handleFirstPlay",value:function(){this._playbackStarted&&this.dispatchEvent(new g(v.CHANGE_SOURCE_ENDED)),this.dispatchEvent(new g(v.PLAYBACK_START)),this.dispatchEvent(new g(v.PLAY)),this.dispatchEvent(new g(v.FIRST_PLAY)),this.dispatchEvent(new g(v.FIRST_PLAYING)),this.dispatchEvent(new g(v.PLAYING)),this.paused&&this.dispatchEvent(new g(v.PAUSE)),this._firstPlay=!1,this._playbackStarted=!0}},{key:"_resumeSession",value:function(){var e=this;this._readyPromise=this._createReadyPromise(),this._mediaInfoIntervalId=setInterval(function(){var t=e._castSession.getMediaSession();t&&t.customData&&(clearInterval(e._mediaInfoIntervalId),e._mediaInfo=t.customData.mediaInfo,e._logger.debug("Resuming session with media info",e._mediaInfo),e._onLoadMediaSuccess())},O)}},{key:"_onLoadMediaSuccess",value:function(){this._logger.debug("Load media success"),this._reset=!1,this._triggerInitialPlayerEvents(),this._tracksManager.parseTracks(),this._handleFirstPlay()}},{key:"_triggerInitialPlayerEvents",value:function(){this.dispatchEvent(new g(v.SOURCE_SELECTED,{selectedSource:[{url:this._castRemotePlayer.mediaInfo.contentUrl,mimetype:this._castRemotePlayer.mediaInfo.contentType}]})),this.dispatchEvent(new g(v.LOADED_METADATA)),this.dispatchEvent(new g(v.ABR_MODE_CHANGED,{mode:k.AUTO}))}},{key:"_onLoadMediaFailed",value:function(e){this._logger.debug("Load media falied",e),this.dispatchEvent(new g(v.ERROR,new C(C.Severity.CRITICAL,C.Category.CAST,C.Code.CAST_LOAD_MEDIA_FAILED,e)))}},{key:"_addSessionLifecycleListeners",value:function(){var e=this;this._castContext.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,function(t){switch(t.sessionState){case cast.framework.SessionState.SESSION_STARTING:e._remoteControl.onRemoteDeviceConnecting();break;case cast.framework.SessionState.SESSION_ENDING:e._remoteControl.onRemoteDeviceDisconnecting();break;case cast.framework.SessionState.SESSION_START_FAILED:e._remoteControl.onRemoteDeviceConnectFailed()}})}},{key:"_getLoadOptions",value:function(e){var t={autoplay:this._playerConfig.playback.autoplay,currentTime:this._playerConfig.playback.startTime,media:{}};if(this.textStyle&&!this.textStyle.isEqual(e.textStyle)&&(t.media.textTrackStyle=w.toCastTextStyle(e.textStyle)),t.media.customData={audioLanguage:this._playerConfig.playback.audioLanguage,textLanguage:this._playerConfig.playback.textLanguage},e.advertising&&e.advertising.adTagUrl){this._adsController=new _.CastAdsController;var a=this._castConfig.advertising;if(a&&a.vast){var n=m.Generator.uniqueId(5),r=m.Generator.uniqueId(5),i=[{id:n,position:0,vastAdsRequest:this._getAdsRequest(e.advertising)}],s=[{breakClipIds:[n],id:r,position:0}];t.media.breakClips=i,t.media.breaks=s}else t.media.vmapAdsRequest=this._getAdsRequest(e.advertising)}return t}},{key:"_getAdsRequest",value:function(e){var t={};return e.adTagUrl&&(t.adTagUrl=e.adTagUrl),e.adsResponse&&(t.adsResponse=e.adsResponse),t}},{key:"_onCustomMessage",value:function(e,t){try{var a=JSON.parse(t);switch(this._logger.debug("Custom message received",a),a.type){case R.EVENT:this._handleCustomEvent(a)}}catch(e){this.dispatchEvent(new g(v.ERROR,new C(C.Severity.RECOVERABLE,C.Category.CAST,C.Code.CAST_CUSTOM_MESSAGE_PARSING_ERROR,e)))}}},{key:"_handleCustomEvent",value:function(e){this.dispatchEvent(new g(e.event,e.payload))}},{key:"ads",get:function(){return this._adsController}},{key:"textStyle",set:function(e){this._tracksManager.textStyle=e},get:function(){return this._tracksManager.textStyle}},{key:"currentTime",set:function(e){this._engine.currentTime=e},get:function(){return this._engine.currentTime}},{key:"duration",get:function(){return this._engine.duration}},{key:"volume",set:function(e){this._engine.volume=e},get:function(){return this._engine.volume}},{key:"paused",get:function(){return this._engine.paused}},{key:"ended",get:function(){return this._ended}},{key:"seeking",get:function(){return this._engine.seeking}},{key:"muted",set:function(e){this._engine.muted=e},get:function(){return this._engine.muted}},{key:"src",get:function(){if(this._castRemotePlayer.mediaInfo)return this._castRemotePlayer.mediaInfo.contentUrl}},{key:"poster",get:function(){try{return this._castRemotePlayer.mediaInfo.metadata.images[0].url}catch(e){return""}}},{key:"playbackRate",get:function(){var e=this._castSession.getMediaSession();if(e)return e.playbackRate}},{key:"engineType",get:function(){return E.CAST}},{key:"type",get:function(){return t.Type}}]),t}(T);L.Type="chromecast",L.defaultConfig={liveEdgeThreshold:5},t.CastPlayer=L},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NAME=t.VERSION=t.RemotePlayer=void 0;var n=a(1),r=a(0),i=r.cast.registerRemotePlayer;t.RemotePlayer=n.CastPlayer,t.VERSION="0.2.5",t.NAME="@playkit-js/playkit-js-cast-sender",n.CastPlayer.isSupported()&&i(n.CastPlayer.Type,n.CastPlayer)},function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.CastStateManager=void 0;var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=a(0),c=o.core.State,l=o.core.FakeEvent,u=o.core.EventType,h=o.core.FakeEventTarget,d=o.core.StateType,_=function(e){function t(e,a){n(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._remotePlayer=e,i._remotePlayerController=a,i._currentState=new c(d.IDLE),i._previousState=new c(d.IDLE),i._updateState=i._updateState.bind(i),i._remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,i._updateState),i}return i(t,e),s(t,[{key:"_updateState",value:function(){this._currentState.duration=Date.now()/1e3,this._previousState=this._currentState,this._remotePlayer.playerState?this._currentState=new c(this._remotePlayer.playerState.toLowerCase()):this._currentState=new c(d.IDLE),this.dispatchEvent(new l(u.PLAYER_STATE_CHANGED,{oldState:this.previousState,newState:this.currentState}))}},{key:"reset",value:function(){this._currentState=new c(d.IDLE),this._previousState=new c(d.IDLE)}},{key:"destroy",value:function(){this._remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,this._updateState),this._currentState=new c(d.IDLE),this._previousState=new c(d.IDLE)}},{key:"currentState",get:function(){return this._currentState}},{key:"previousState",get:function(){return this._previousState}}]),t}(h);t.CastStateManager=_},function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Object.defineProperty(t,"__esModule",{value:!0}),t.CastTracksManager=void 0;var o,c=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),l=a(0),u=a(1),h=l.cast.TextStyleConverter,d=(l.core.Track,l.core.getLogger),_=l.core.TextStyle,y=l.core.AudioTrack,f=l.core.VideoTrack,v=l.core.TextTrack,p=l.core.Utils,g=l.core.TrackType,m=l.core.EventType,E=l.core.FakeEvent,k=l.core.FakeEventTarget,C=l.core.Error,T=(o={},s(o,g.AUDIO,y),s(o,g.VIDEO,f),s(o,g.TEXT,v),o),S=function(e){function t(e){n(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a._activeTrackIds=[],a._tracks=[],a._remotePlayer=e,a._logger=d("CastTracksManager"),a._castSession=cast.framework.CastContext.getInstance().getCurrentSession(),a._textStyle=new _,a._bindEvents(),a}return i(t,e),c(t,[{key:"parseTracks",value:function(){var e=this._remotePlayer.mediaInfo.tracks;if(e&&e.length>0){var t=e.filter(function(e){return e.type===chrome.cast.media.TrackType.TEXT}),a=e.filter(function(e){return e.type===chrome.cast.media.TrackType.VIDEO}),n=e.filter(function(e){return e.type===chrome.cast.media.TrackType.AUDIO}),r=this._parseTextTracks(t),i=this._parseVideoTracks(a),s=this._parseAudioTracks(n);this._tracks=s.concat(i).concat(r),this._addTextTrackOffOption()}this._logger.debug("Parse tracks",this._tracks),this._startOnMediaStatusUpdateInterval(),this.dispatchEvent(new E(m.TRACKS_CHANGED,{tracks:this._tracks}))}},{key:"getTracks",value:function(e){return p.Object.copyDeep(this._getTracksByType(e))}},{key:"getActiveTracks",value:function(){return p.Object.copyDeep({video:this._getTracksByType(g.VIDEO).find(function(e){return e.active}),audio:this._getTracksByType(g.AUDIO).find(function(e){return e.active}),text:this._getTracksByType(g.TEXT).find(function(e){return e.active})})}},{key:"selectTrack",value:function(e){e instanceof f?this._selectVideoTrack(e):e instanceof y?this._selectAudioTrack(e):e instanceof v&&this._selectTextTrack(e)}},{key:"hideTextTrack",value:function(){var e=this._tracks.find(function(e){return"off"===e.language});this.selectTrack(e)}},{key:"reset",value:function(){this._stopOnMediaStatusUpdateInterval(),this._tracks=[],this._activeTrackIds=[]}},{key:"destroy",value:function(){this._stopOnMediaStatusUpdateInterval(),this._tracks=[],this._activeTrackIds=[]}},{key:"_startOnMediaStatusUpdateInterval",value:function(){this._mediaStatusIntervalId=setInterval(this._onMediaStatusUpdate,u.INTERVAL_FREQUENCY)}},{key:"_stopOnMediaStatusUpdateInterval",value:function(){this._mediaStatusIntervalId&&(clearInterval(this._mediaStatusIntervalId),this._mediaStatusIntervalId=null)}},{key:"_bindEvents",value:function(){this._onMediaStatusUpdate=this._onMediaStatusUpdate.bind(this)}},{key:"_parseTextTracks",value:function(e){var t=[];return e.forEach(function(e){var a={id:e.trackId,index:e.trackId-1,label:e.name,language:e.language,kind:e.subType||"subtitles",active:!1};t.push(new v(a))}),t}},{key:"_parseVideoTracks",value:function(e){var t=[];return e.forEach(function(e){var a={id:e.trackId,index:e.trackId-1,label:e.name,language:e.language,active:!1};t.push(new f(a))}),t}},{key:"_parseAudioTracks",value:function(e){var t=[];return e.forEach(function(e){var a={id:e.trackId,index:e.trackId-1,label:e.name,language:e.language,active:!1};t.push(new y(a))}),t}},{key:"_selectVideoTrack",value:function(e){var t=this;this._stopOnMediaStatusUpdateInterval();var a=this.getActiveTracks().video;this._selectTrack(e,a,function(){t.dispatchEvent(new E(m.VIDEO_TRACK_CHANGED,{selectedVideoTrack:e})),t._startOnMediaStatusUpdateInterval()},function(e){t.dispatchEvent(new E(m.ERROR,new C(C.Severity.RECOVERABLE,C.Category.CAST,C.Code.EDIT_TRACKS_INFO_ERROR,e)))})}},{key:"_selectAudioTrack",value:function(e){var t=this;this._stopOnMediaStatusUpdateInterval();var a=this.getActiveTracks().audio;this._selectTrack(e,a,function(){t.dispatchEvent(new E(m.AUDIO_TRACK_CHANGED,{selectedAudioTrack:e})),t._startOnMediaStatusUpdateInterval()},function(e){t.dispatchEvent(new E(m.ERROR,new C(C.Severity.RECOVERABLE,C.Category.CAST,C.Code.CAST_EDIT_TRACKS_INFO_ERROR,e)))})}},{key:"_selectTextTrack",value:function(e){var t=this;this._stopOnMediaStatusUpdateInterval();var a=this.getActiveTracks().text;this._selectTrack(e,a,function(){t.dispatchEvent(new E(m.TEXT_TRACK_CHANGED,{selectedTextTrack:e})),t._startOnMediaStatusUpdateInterval()},function(e){t.dispatchEvent(new E(m.ERROR,new C(C.Severity.RECOVERABLE,C.Category.CAST,C.Code.EDIT_TRACKS_INFO_ERROR,e)))})}},{key:"_selectTrack",value:function(e,t,a,n){var r=this;if(this._logger.debug("Select track",e,t,this._activeTrackIds),t){var i=this._activeTrackIds.indexOf(t.id);i>-1&&this._activeTrackIds.splice(i,1)}e.id&&"off"!==e.language&&this._activeTrackIds.push(e.id);var s=new chrome.cast.media.EditTracksInfoRequest(this._activeTrackIds);this._castSession.getMediaSession().editTracksInfo(s,function(){r._logger.debug("Select track succeeded"),r._markActiveTrack(t,!1),r._markActiveTrack(e,!0),a()},function(e){r._logger.debug("Select track failed",e),n(e)})}},{key:"_markActiveTrack",value:function(e,t){if(e){var a=e.id,n=this._tracks.find(function(e){return e.id===a});n&&(n.active=t)}}},{key:"_addTextTrackOffOption",value:function(){var e=this._getTracksByType(g.TEXT),t=e[e.length-1];e&&e.length&&this._tracks.push(new v({id:t.id+1,active:!0,index:t.index+1,kind:"subtitles",label:"Off",language:"off"}))}},{key:"_getTracksByType",value:function(e){return e?this._tracks.filter(function(t){return!e||!T[e]||t instanceof T[e]}):this._tracks}},{key:"_onMediaStatusUpdate",value:function(){var e=this,t=this._castSession.getMediaSession();if(t){if(function(){return!!t.activeTrackIds&&!(e._activeTrackIds.length===t.activeTrackIds.length&&e._activeTrackIds.every(function(e,a){return e===t.activeTrackIds[a]}))}()){t.activeTrackIds.filter(function(t){return!e._activeTrackIds.includes(t)}).forEach(function(t){var a=e._tracks.find(function(e){return e.id===t});e.selectTrack(a)})}if(function(){var a=h.toCastTextStyle(e.textStyle),n=t.media.textTrackStyle;return!!n&&!(a.backgroundColor===n.backgroundColor&&a.fontFamily===n.fontFamily&&a.fontScale===n.fontScale&&a.foregroundColor===n.foregroundColor)}()){var a=h.toPlayerTextStyle(t.media.textTrackStyle);this._textStyle=a,this.dispatchEvent(new E(m.TEXT_STYLE_CHANGED,{textStyle:a}))}}}},{key:"textStyle",set:function(e){var t=this;this._logger.debug("Setting text style",e);var a=h.toCastTextStyle(e),n=new chrome.cast.media.EditTracksInfoRequest(null,a);this._castSession.getMediaSession().editTracksInfo(n,function(){t._logger.debug("Setting text style succeed"),t._textStyle=e,t.dispatchEvent(new E(m.TEXT_STYLE_CHANGED,{textStyle:e}))},function(e){t._logger.debug("Setting text style failed",e),t.dispatchEvent(new E(m.ERROR,new C(C.Severity.RECOVERABLE,C.Category.CAST,C.Code.EDIT_TRACKS_INFO_ERROR,e)))})},get:function(){return this._textStyle.clone()}}]),t}(k);t.CastTracksManager=S},function(e,t,a){"use strict";function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.CastPlaybackEngine=void 0;var o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),c=a(0),l=a(1),u=c.core.EventType,h=c.core.FakeEvent,d=c.core.FakeEventTarget,_=function(e){function t(e,a){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._muted=!1,n._volume=1,n._paused=!1,n._currentTime=0,n._duration=0,n._seeking=!1,n._remotePlayer=e,n._remotePlayerController=a,n._bindEvents(),n._toggleListeners(!0),n}return s(t,e),o(t,[{key:"reset",value:function(){this._toggleListeners(!1),clearInterval(this._liveCurrentTimeIntervalId),this._resetFlags(),this._toggleListeners(!0)}},{key:"destroy",value:function(){clearInterval(this._liveCurrentTimeIntervalId),this._toggleListeners(!1),this._muted=!1,this._volume=1,this._resetFlags()}},{key:"play",value:function(){this._remotePlayerController.playOrPause()}},{key:"pause",value:function(){this._remotePlayer.canPause&&this._remotePlayerController.playOrPause()}},{key:"_resetFlags",value:function(){this._paused=!1,this._currentTime=0,this._duration=0,this._seeking=!1}},{key:"_bindEvents",value:function(){this._onCurrentTimeChanged=this._onCurrentTimeChanged.bind(this),this._onIsPausedChanged=this._onIsPausedChanged.bind(this),this._onDurationChanged=this._onDurationChanged.bind(this),this._onVolumeLevelChanged=this._onVolumeLevelChanged.bind(this),this._onIsMutedChanged=this._onIsMutedChanged.bind(this),this._onIsMediaLoadedChanged=this._onIsMediaLoadedChanged.bind(this),this._onLiveCurrentTimeChanged=this._onLiveCurrentTimeChanged.bind(this)}},{key:"_toggleListeners",value:function(e){var t,a=this,r=(t={},n(t,cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED,this._onIsMediaLoadedChanged),n(t,cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED,this._onIsPausedChanged),n(t,cast.framework.RemotePlayerEventType.DURATION_CHANGED,this._onDurationChanged),n(t,cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,this._onVolumeLevelChanged),n(t,cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,this._onIsMutedChanged),t);e?Object.keys(r).forEach(function(e){return a._remotePlayerController.addEventListener(e,r[e])}):(Object.keys(r).forEach(function(e){return a._remotePlayerController.removeEventListener(e,r[e])}),this._remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,this._onCurrentTimeChanged))}},{key:"_onIsMediaLoadedChanged",value:function(e){var t=this,a=function e(){t._remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,e),t._remotePlayer.mediaInfo.streamType===chrome.cast.media.StreamType.LIVE?(t._mediaSession=cast.framework.CastContext.getInstance().getCurrentSession().getMediaSession(),t._liveCurrentTimeIntervalId=setInterval(t._onLiveCurrentTimeChanged,l.INTERVAL_FREQUENCY)):t._remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,t._onCurrentTimeChanged)};e.value&&this._remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,a)}},{key:"_onCurrentTimeChanged",value:function(){this._currentTime=this._remotePlayer.currentTime,this._maybeDispatchTimeUpdate(),this._maybeEndPlayback()}},{key:"_onLiveCurrentTimeChanged",value:function(){this._currentTime=this._mediaSession.currentTime,this._maybeDispatchTimeUpdate(),this._maybeEndLivePlayback()}},{key:"_onIsPausedChanged",value:function(){this._paused=this._remotePlayer.isPaused,this._paused?this.dispatchEvent(new h(u.PAUSE)):this.dispatchEvent(new h(u.PLAY))}},{key:"_onDurationChanged",value:function(){this._duration=this._remotePlayer.duration,this.dispatchEvent(new h(u.DURATION_CHANGE))}},{key:"_onVolumeLevelChanged",value:function(){this._volume=this._remotePlayer.volumeLevel,this.dispatchEvent(new h(u.VOLUME_CHANGE))}},{key:"_onIsMutedChanged",value:function(){this._muted=this._remotePlayer.isMuted,this.dispatchEvent(new h(u.MUTE_CHANGE,{mute:this.muted}))}},{key:"_maybeDispatchTimeUpdate",value:function(){this._seeking?this._seekTargetTime&&(this._seekForward&&this.currentTime>=this._seekTargetTime||!this._seekForward&&this.currentTime<=this._seekTargetTime)&&(this._seeking=!1,this._seekTargetTime=null,this.dispatchEvent(new h(u.SEEKED)),this.dispatchEvent(new h(u.TIME_UPDATE))):this.dispatchEvent(new h(u.TIME_UPDATE))}},{key:"_maybeEndPlayback",value:function(){var e=Math.round(this._duration-this._currentTime);0!==this._currentTime&&0!==this._duration&&e<=1&&(this._currentTime=this._duration,this._paused=!0,this.dispatchEvent(new h(u.ENDED)))}},{key:"_maybeEndLivePlayback",value:function(){var e=this._mediaSession.liveSeekableRange;e&&e.isLiveDone&&(this._paused=!0,this.dispatchEvent(new h(u.ENDED)))}},{key:"muted",set:function(e){(e&&!this.muted||!e&&this.muted)&&this._remotePlayerController.muteOrUnmute()},get:function(){return this._muted}},{key:"volume",set:function(e){this._remotePlayer.canControlVolume&&(this._remotePlayer.volumeLevel=e,this._remotePlayerController.setVolumeLevel())},get:function(){return this._volume}},{key:"currentTime",set:function(e){this._remotePlayer.canSeek&&(this._seeking=!0,this.dispatchEvent(new h(u.SEEKING)),this._remotePlayer.currentTime=this._seekTargetTime=e,this._seekForward=e>this.currentTime,this._remotePlayerController.seek())},get:function(){return this._remotePlayer.savedPlayerState?this._remotePlayer.savedPlayerState.currentTime:this._currentTime}},{key:"duration",get:function(){return this._duration}},{key:"paused",get:function(){return this._remotePlayer.savedPlayerState?this._remotePlayer.savedPlayerState.isPaused:this._paused}},{key:"seeking",get:function(){return this._seeking}}]),t}(d);t.CastPlaybackEngine=_},function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.CastUI=void 0;var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=a(0),c=o.ui.style,l=o.ui.Components,u=o.cast.RemotePlayerUI,h=function(e){function t(){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,[{key:"playbackUI",value:function(e){return o.ui.h("div",{className:c.playbackGuiWWrapper},o.ui.h(l.KeyboardControl,{player:e.player,config:e.config}),o.ui.h(l.Loading,{player:e.player}),o.ui.h("div",{className:c.playerGui,id:"player-gui"},o.ui.h(l.OverlayPortal,null),o.ui.h(l.BottomBar,null,o.ui.h(l.SeekBarPlaybackContainer,{showFramePreview:!0,showTimeBubble:!0,player:e.player,playerContainer:e.playerContainer}),o.ui.h("div",{className:c.leftControls},o.ui.h(l.PlaybackControls,{player:e.player}),o.ui.h(l.RewindControl,{player:e.player,step:10}),o.ui.h(l.TimeDisplayPlaybackContainer,{format:"current / total"})),o.ui.h("div",{className:c.rightControls},o.ui.h(l.VolumeControl,{player:e.player}),o.ui.h(l.LanguageControl,{player:e.player}),o.ui.h(l.CastControl,{player:e.player}),o.ui.h(l.FullscreenControl,{player:e.player}))),o.ui.h(l.CastOverlay,{player:e.player}),o.ui.h(l.OverlayAction,{player:e.player}),o.ui.h(l.PlaybackControls,{player:e.player})),o.ui.h(l.PrePlaybackPlayOverlay,{player:e.player}),o.ui.h(l.CastAfterPlay,{player:e.player}))}},{key:"liveUI",value:function(e){return o.ui.h("div",{className:c.playbackGuiWWrapper},o.ui.h(l.KeyboardControl,{player:e.player,config:e.config}),o.ui.h(l.Loading,{player:e.player}),o.ui.h("div",{className:c.playerGui,id:"player-gui"},o.ui.h(l.OverlayPortal,null),o.ui.h(l.BottomBar,null,o.ui.h(l.SeekBarLivePlaybackContainer,{showFramePreview:!0,showTimeBubble:!0,player:e.player,playerContainer:e.playerContainer}),o.ui.h("div",{className:c.leftControls},o.ui.h(l.PlaybackControls,{player:e.player}),o.ui.h(l.LiveTag,{player:e.player})),o.ui.h("div",{className:c.rightControls},o.ui.h(l.VolumeControl,{player:e.player}),o.ui.h(l.LanguageControl,{player:e.player}),o.ui.h(l.CastControl,{player:e.player}),o.ui.h(l.FullscreenControl,{player:e.player}))),o.ui.h(l.CastOverlay,{player:e.player}),o.ui.h(l.OverlayAction,{player:e.player}),o.ui.h(l.PlaybackControls,{player:e.player})),o.ui.h(l.PrePlaybackPlayOverlay,{player:e.player}),o.ui.h(l.CastAfterPlay,{player:e.player}))}},{key:"idleUI",value:function(e){return o.ui.h("div",{className:c.playbackGuiWWrapper},o.ui.h(l.Loading,{player:e.player}),o.ui.h(l.CastOverlay,{player:e.player}))}},{key:"adsUI",value:function(e){return o.ui.h("div",{className:c.adGuiWrapper},o.ui.h(l.KeyboardControl,{player:e.player,config:e.config}),o.ui.h(l.Loading,{player:e.player}),o.ui.h("div",{className:c.playerGui,id:"player-gui"},o.ui.h(l.CastOverlay,{player:e.player}),o.ui.h(l.OverlayAction,{player:e.player}),o.ui.h("div",null,o.ui.h(l.TopBar,null,o.ui.h("div",{className:c.leftControls},o.ui.h(l.AdNotice,null)),o.ui.h("div",{className:c.rightControls},o.ui.h(l.AdLearnMore,null))),o.ui.h(l.AdSkip,{player:e.player})),o.ui.h(l.BottomBar,null,o.ui.h("div",{className:c.leftControls},o.ui.h(l.PlaybackControls,{player:e.player}),o.ui.h(l.TimeDisplayAdsContainer,null)),o.ui.h("div",{className:c.rightControls},o.ui.h(l.VolumeControl,{player:e.player}),o.ui.h(l.CastControl,{player:e.player}),o.ui.h(l.FullscreenControl,{player:e.player}))),o.ui.h(l.PlaybackControls,{player:e.player})))}}]),t}(u);t.CastUI=h},function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.CastLoader=void 0;var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=a(0),s=i.core.Utils,o=i.core.getLogger,c=function(){function e(){n(this,e)}return r(e,null,[{key:"load",value:function(){return new Promise(function(t,a){window.__onGCastApiAvailable=function(a){return e._onGCastApiAvailable(a,t)},e._loadCastSDK().then(function(){return e._logger.debug("Cast sender lib has been loaded successfully")}).catch(function(t){e._logger.debug("Cast sender lib loading failed",t),a(t)})})}},{key:"_loadCastSDK",value:function(){return window.cast&&window.cast.framework?Promise.resolve():s.Dom.loadScriptAsync("//www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1")}},{key:"_onGCastApiAvailable",value:function(t,a){e._logger.debug("onGCastApiAvailable, isAvailable: "+t.toString()),t?a():e._logger.debug("Google cast API isn't available yet")}}]),e}();c._logger=o("CastLoader"),t.CastLoader=c},function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.CastAdsController=void 0;var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=a(1),s=a(0),o=s.cast.CustomActionMessage,c=s.cast.CustomActionType,l=function(){function e(){n(this,e),this._castSession=cast.framework.CastContext.getInstance().getCurrentSession()}return r(e,[{key:"skipAd",value:function(){this._castSession.sendMessage(i.CUSTOM_CHANNEL,new o(c.SKIP_AD))}}]),e}();t.CastAdsController=l},function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.CastAdsManager=void 0;var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=(a(1),a(0)),c=o.core.EventManager,l=o.core.EventType,u=o.core.FakeEventTarget,h=function(e){function t(e){n(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a._adBreak=!1,a._allAdsCompleted=!0,a._castPlayer=e,a._eventManager=new c,a._attachListeners(),a}return i(t,e),s(t,[{key:"_attachListeners",value:function(){var e=this;this._eventManager.listen(this._castPlayer,l.AD_MANIFEST_LOADED,function(){e._allAdsCompleted=!1}),this._eventManager.listen(this._castPlayer,l.AD_BREAK_START,function(){e._adBreak=!0}),this._eventManager.listen(this._castPlayer,l.AD_BREAK_END,function(){e._adBreak=!1}),this._eventManager.listen(this._castPlayer,l.ALL_ADS_COMPLETED,function(){e._allAdsCompleted=!0})}},{key:"reset",value:function(){this._eventManager.removeAll(),this._adBreak=!1,this._allAdsCompleted=!0,this._attachListeners()}},{key:"destroy",value:function(){this._adBreak=!1,this._allAdsCompleted=!0,this._eventManager.destroy()}},{key:"adBreak",get:function(){return this._adBreak}},{key:"allAdsCompleted",get:function(){return this._allAdsCompleted}}]),t}(u);t.CastAdsManager=h}])});
//# sourceMappingURL=playkit-cast-sender.js.map